# S-100海事服务平台 - 数据库种子数据

## 📁 目录结构

```
prisma/seed/
├── README.md                    # 本说明文件
├── index.ts                     # 主种子文件，按功能模块顺序调用
├── run-seed.ts                  # 种子脚本运行器
├── auth/                        # 🔐 认证和权限模块
│   ├── 01-user-scenarios.seed.ts    # 用户场景数据
│   ├── 02-role-permissions.seed.ts   # 角色权限数据
│   ├── 03-scenario-roles.seed.ts    # 场景角色关联数据
│   └── 04-users.seed.ts             # 用户数据
├── nodes/                       # 🌐 节点管理模块
│   ├── 01-node-hierarchy.seed.ts    # 节点层级结构数据
│   └── 02-node-capabilities.seed.ts  # 节点能力数据
├── datasets/                    # 📊 数据集管理模块
│   └── 01-datasets.seed.ts          # 数据集数据
├── services/                    # 🚀 服务管理模块
│   ├── 01-services.seed.ts          # 服务实例数据
│   └── 02-service-directory.seed.ts # 服务目录条目数据
└── system/                      # ⚙️ 系统配置模块
    ├── 01-system-config.seed.ts     # 系统配置数据
    └── 02-sample-posts.seed.ts      # 示例帖子数据
```

## 🎯 设计原则

### KISS原则 (Keep It Simple, Stupid)
- **单一职责**: 每个seed文件只负责一个功能模块的数据
- **简单明了**: 文件名和函数名清晰表达功能
- **易于维护**: 模块化设计，便于独立修改和测试

### 按功能分类
- **认证和权限模块**: 用户、角色、权限相关数据
- **节点管理模块**: S-100分层节点架构相关数据
- **数据集管理模块**: S-100产品数据集相关数据
- **服务管理模块**: WMS/WFS/WCS服务相关数据
- **系统配置模块**: 系统配置和示例内容数据

## 📋 模块说明

### 🔐 认证和权限模块 (`auth/`)

1. **用户场景** (`01-user-scenarios.seed.ts`)
   - 定义5种用户使用场景
   - 终端用户、数据管理员、区域管理者、系统管理员、服务提供商

2. **角色权限** (`02-role-permissions.seed.ts`)
   - 定义6种用户角色的默认权限
   - 系统管理员、节点管理员、数据管理员、服务管理员、普通用户、游客

3. **场景角色关联** (`03-scenario-roles.seed.ts`)
   - 关联用户场景和角色
   - 定义场景特定的权限配置

4. **用户数据** (`04-users.seed.ts`)
   - 创建示例用户
   - 包括各级管理员和终端用户

### 🌐 节点管理模块 (`nodes/`)

1. **节点层级结构** (`01-node-hierarchy.seed.ts`)
   - 创建S-100分层节点架构
   - 全球根节点 → 国家级节点 → 区域节点 → 叶子节点

2. **节点能力** (`02-node-capabilities.seed.ts`)
   - 定义各节点的S-100产品和服务能力
   - 支持S101、S102、S104、S111等产品类型

### 📊 数据集管理模块 (`datasets/`)

1. **数据集数据** (`01-datasets.seed.ts`)
   - 创建示例S-100数据集
   - 包括电子海图、高精度水深、动态水位、实时海流等

### 🚀 服务管理模块 (`services/`)

1. **服务实例** (`01-services.seed.ts`)
   - 为数据集创建WMS、WFS、WCS服务实例
   - 自动生成服务端点和配置

2. **服务目录** (`02-service-directory.seed.ts`)
   - 创建服务目录条目
   - 支持服务发现和访问

### ⚙️ 系统配置模块 (`system/`)

1. **系统配置** (`01-system-config.seed.ts`)
   - 创建系统基础配置
   - 包括应用信息、安全配置、同步配置等

2. **示例帖子** (`02-sample-posts.seed.ts`)
   - 创建示例内容
   - 用于演示和测试

## 🚀 使用方法

### 运行所有种子数据
```bash
npm run db:setup
```

### 单独运行种子脚本
```bash
npx tsx prisma/seed/run-seed.ts
```

### 开发环境重置
```bash
npm run db:reset
```

## 📊 数据统计

运行完成后，数据库将包含：

- **用户场景**: 5个
- **角色权限**: 40+个
- **节点层级**: 5个（全球根节点→中国→东海分局→上海港→宁波港）
- **节点能力**: 7个
- **数据集**: 5个
- **服务实例**: 10+个
- **服务目录**: 7个
- **系统配置**: 10个
- **用户**: 8个
- **示例帖子**: 4个

## 🔧 自定义和扩展

### 添加新的功能模块
1. 在相应目录下创建新的seed文件
2. 按照命名规范：`XX-module-name.seed.ts`
3. 在`index.ts`中导入并调用

### 修改现有数据
1. 找到对应的功能模块文件
2. 修改数据内容
3. 重新运行种子脚本

### 添加新的节点或数据集
1. 修改对应的seed文件
2. 添加新的数据记录
3. 确保关联关系正确

## ⚠️ 注意事项

1. **开发环境**: 在开发环境下会自动清理现有数据
2. **生产环境**: 在生产环境下请谨慎使用，建议先备份数据
3. **数据依赖**: 模块间有依赖关系，按顺序执行
4. **错误处理**: 每个模块都有独立的错误处理，重复数据会被跳过

## 🔄 数据流

```
认证权限 → 节点管理 → 数据集管理 → 服务管理 → 系统配置
    ↓           ↓           ↓           ↓           ↓
  用户场景   节点层级     数据集      服务实例     系统配置
  角色权限   节点能力               服务目录     示例内容
  场景关联
  用户数据
```

这种模块化的设计使得数据种子脚本更加清晰、易于维护和扩展。